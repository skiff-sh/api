syntax = "proto3";

package skiff.plugin.v1alpha1;

option go_package = "github.com/skiff-sh/api/go/skiff/plugin/v1alpha1";

// A single object housing all supported requests. All corresponding responses are of the same name on the Response object.
message Request {
  // Metadata for the request.
  RequestMetadata metadata = 1;

  // The schema data by name specified by the user. All available fields can be found in the "schema" field of the package.
  map<string, Value> data = 2;

  // Write a file to the user's machine.
  optional WriteFileRequest write_file = 3 [json_name = "write_file"];
}

message RequestMetadata {
  // The name of the package that initiated the request.
  string package = 1;

  // The intended target specified in the package.
  string target = 2;

  // The path of the original plugin file in the package.
  string path = 3;
}

message Value {
  message List {
    repeated string strings = 1;
    repeated double numbers = 2;
  }

  optional string string = 1;
  optional bool bool = 2;
  optional double number = 3;
  optional List list = 4;
}

// A single object housing all supported responses.
message Response {
  // If any issues are encountered, surface them to the user.
  repeated Issue issues = 1;

  // The response body for the write_file request.
  optional WriteFileResponse write_file = 2 [json_name = "write_file"];
}

message Issue {
  enum Level {
    // Displays nothing. Essentially a no-op.
    LEVEL_UNSPECIFIED = 0;

    // Displays a message to the user but does not exit.
    LEVEL_WARN = 1;

    // Displays a message to the user and exits.
    LEVEL_ERROR = 2;
  }

  // The level of the issue. If set to error, the command fails.
  Level level = 1;

  // The message surfaced to the user.
  string message = 2;
}

// Write a file to the user's machine.
message WriteFileRequest {}

message WriteFileResponse {
  // The new contents of the file.
  bytes contents = 1;
}
